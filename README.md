# Comprehensive understanding of Tn5 insertion preference recovers expansive transcription regulatory lexicon

**Author**: Houyu Zhang

**Email**: Hughiez047@gmail.com

## Introduction

Tn5 transposase has been widely adopted as a molecular tool in next-generation sequencing. With more types of Tn5 segmented data subjected to precision genomics, the impact on Tn5 insertion bias comes into focus. Besides, whether explicitly correct the Tn5 bias benefits its general applications is of interest for genomic studies. 

Here we systematically explored Tn5 insertion characteristics across several model organisms to find critical parameters affect its insertion preference. An initial evaluation of Tn5 insertion distribution along naked genomic DNA revealed that Tn5 insertion is not uniformly random. Leveraging a machine learning framework, we found that DNA shape independently or cooperatively works with DNA motif to affect Tn5 insertion. These intrinsic preferences can be faithfully modeled for computational correction using nucleotide dependency information from DNA sequences. 

To promote bias-corrected ATAC-seq analysis, we hence developed a pipeline for this purpose. Using our pipeline, we showed the bias correction would improve the overall performance of ATAC-seq peak detection. Importantly, we showed that with bias correction, many potential false-negative peaks could be recovered. By conducting a genome-wide transcription factors (TFs) enrichment analysis, we found these peaks contain abundant TFs. We propose that a comprehensive understanding and precise correction of Tn5 insertion preference could broaden the view of Tn5-assisted sequencing data. 

## Scripts organization

- Scripts head with `0_` is for general preprocessing NGS data, include

   `ATAC-seq`,  `WGBS`,  `MNase-seq` ,`RNA-seq` ,`ChIP-seq` 

- Script head with series number is pipeline for specific analysis follows the order in the Tn5 paper.

  Specifically, the `bash script` and `python script` is for processing data and corresponding `R scripts` is used for downstream analysis, statistics and plotting.
  
- Scripts in the StandaloneScript folder was called by pipelines.

## Tn5-bias corrected ATAC-seq pipeline

This pipeline is composed of a bash script and configure `yaml` file. 

### Prerequisites

We recommend using a conda environment to run this pipeline and you can install all dependent packages as following:

```bash
conda env create -f BiasFreeATAC.yaml
source activate BiasFreeATAC
```

As for the correction package seqOutBias, we recommend to install following these [instructions](https://github.com/guertinlab/seqOutBias).

### Help information:

```bash
$ bash BiasFreeATAC.sh -h
Usage: BiasFreeATAC.sh [options]

-r <string>             ATAC-seq Read1 fastq file (_R1.fastq.gz)
-i <string>             Location of Bowtie2 mapping index
-g <string>             Genome size for each chromosome
-f <string>             Genome reference fasta file
-l <string>             Blacklist regions (provide if avaliable)
-p <string>             Thresholds for parallelly run this pipeline
-o <string>             Working directory, all output files will be generated here
```

`-r` The Read1 of raw fastq file. In order to unify the pipeline, we suggest you name the file following this format: `Sample_R1.fastq.gz` and `Sample_R2.fastq.gz`.

`-i` The location of bowtie index for mapping

`-g` Chromosome size. You can obtain it from:

- UCSC using `fetchChromSizes hg38 > hg38.chrom.sizes`
- index of genome fasta file `samtools faidx input.fa` `cut -f1,2 input.fa.fai > chrom.sizes`  

`-f` Genome sequence file in fasta format.

`-l` Blacklist that removed from this analysis. You can found the list in [here](https://github.com/Boyle-Lab/Blacklist).  

`-p` Thresholds for parallel running the pipeline.

`-o` Working directory. All files will be generated under this directory. Will build one if not exist.

### Example on mESC:

```bash
bash BiasFreeATAC.sh \
-r Mouse_ESC_ATACseq_R1.fastq.gz \
-i ~/Genomes_info/Mus_musculus/bowtie2_index/mm10_index \
-g ~/Genomes_info/Mus_musculus/mm10.chrom.sizes \
-f ~/Genomes_info/Mus_musculus/Mus_musculus.GRCm38.dna.primary_assembly_chrM.fa \
-p 30 \
-o test
```

### Output files
1. **`.InsertSites.bam`**

   This file store Tn5 cut sites, which were processed from raw reads. Specifically, we shifted reads on the forward strand by +4 bp and reads on the reverse strand by -5 bp, followed the instructions previously reported (Buenrostro *et al*., 2013).

2. **`.InsertSites_atacorrect.pdf` `.InsertSites_corrected.bw` `.InsertSites_uncorrected.bw`**

   These files were generated by the `ATACorrect` command from TOBIAS (Bentsen *et al*., 2020). The `.InsertSites_corrected.bw` file was used for SFA.

3. **`.InsertSites_corrected.tab` `.InsertSites_corrected.TSS.bed`**

   These files store corrected Tn5 insertions around TSS (+/- 200 bp) and corresponding TSS locations.


